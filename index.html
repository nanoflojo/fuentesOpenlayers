<!DOCTYPE html>
<html lang="es">
<meta http-equiv="Content-Type" content="text/html" charset="utf-8">
<meta name="viewport"
    content="width=device-width, initial-scale=1.0, maximumscale=1.0 , shrink-to-fit=no, user-scalable=no" />
<meta name="robots" content="index,follow" />
<meta name="description" content="Mapa interactivo para visualizar las fuentes y manantiales de agua en España" />
<meta name="keywords"
    content="mapa, fuentes, agua, potable, manantiales, rutas, MTB, BTT, Madrid, Prug, sendas verdes, bici, bicicleta, montaña, ciclismo, tracks" />
<meta name="author" content="Nano Flojo" />
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="application-name" content="Fuentes">
<meta name="apple-mobile-web-app-title" content="Fuentes">
<meta name="theme-color" content="#969696">
<meta name="msapplication-navbutton-color" content="#969696">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="msapplication-starturl" content="/index.html">

<head>
    <title>Fuentes de agua en España</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@v10.4.0/ol.css" />
    <script src="https://cdn.jsdelivr.net/npm/ol@v10.4.0/dist/ol.js"></script>
    <!--LayerSwitcher-->
    <link rel="stylesheet" href="https://unpkg.com/ol-layerswitcher@4.1.2/dist/ol-layerswitcher.css" />
    <script src="https://unpkg.com/ol-layerswitcher@4.1.2"></script>
    <!--Control Geocoder-->
    <link href="https://cdn.jsdelivr.net/npm/ol-geocoder/dist/ol-geocoder.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/ol-geocoder/dist/ol-geocoder.js"></script>

    <style>
        :root {
            --primary-color: #000000;
            --secondary-color: rgba(255, 255, 255, 0.5);
            --border-color: rgba(173, 217, 239, 0.7);
            --popup-bg-color: white;
            --popup-shadow: 0 1px 4px rgba(0, 0, 0, 0.2);
            --popup-border-color: #ccc;
            --tooltip-top: 3px;
            --zoomslider-bg: transparent;
            --mouse-position-font-size: 12px;
            --geocoder-btn-size: 25px;
        }

        html,
        body,
        #map {
            width: 100%;
            height: 100%;
            overflow: hidden;
            position: absolute;
            z-index: 1;
            top: 0;
            bottom: 0;
        }

        .ol-rotate {
            top: 2em;
        }

        .layer-switcher {
            position: absolute;
            top: 4em;
            right: 0.5em;
            text-align: left;
        }

        .layer-switcher .panel {
            border: 4px solid #33607F;
            border-radius: 10px;
            width: auto;
            font-size: small;
        }

        #map .ol-zoom .ol-zoom-out,
        #map .ol-touch .ol-zoom .ol-zoom-out {
            margin-top: 204px;
        }

        #map .ol-zoomslider,
        #map .ol-touch .ol-zoomslider {
            background-color: var(--zoomslider-bg);
            top: 2.3em;
        }

        #map .ol-zoom-in.ol-has-tooltip:hover [role=tooltip],
        #map .ol-zoom-in.ol-has-tooltip:focus [role=tooltip],
        #map .ol-zoom-out.ol-has-tooltip:hover [role=tooltip],
        #map .ol-zoom-out.ol-has-tooltip:focus [role=tooltip] {
            top: var(--tooltip-top);
        }

        .ol-scale-line {
            margin-left: 50%;
            bottom: 0.6em;
        }

        .ol-mouse-position {
            position: absolute;
            top: 0.5em;
            margin-right: 3em;
            color: var(--primary-color);
            background-color: var(--secondary-color);
            border: solid 3px var(--border-color);
            font-size: var(--mouse-position-font-size);
        }

        .ol-geocoder.gcd-gl-container {
            top: 270px;
        }

        .ol-geocoder .gcd-gl-control,
        .ol-geocoder .gcd-gl-btn {
            height: var(--geocoder-btn-size);
            width: var(--geocoder-btn-size);
        }

        .ol-geocoder .gcd-gl-expanded {
            height: 2em;
            width: 15.625em;
        }

        .posicion-actual {
            top: 300px;
            left: .5em;
        }

        .ol-touch .posicion-actual {
            top: 320px;
        }

        .ol-popup {
            position: absolute;
            min-width: 180px;
            background-color: var(--popup-bg-color);
            -webkit-filter: drop-shadow(var(--popup-shadow));
            filter: drop-shadow(var(--popup-shadow));
            padding: 15px;
            border: 3px solid #5a7ba6;
            border-radius: 10px 10px 10px 10px;
            bottom: 12px;
            left: -50px;
        }

        .ol-popup:after,
        .ol-popup:before {
            top: 100%;
            border: solid transparent;
            content: " ";
            height: 0;
            width: 0;
            position: absolute;
            pointer-events: none;
        }

        .ol-popup:after {
            border-top-color: var(--popup-bg-color);
            border-width: 10px;
            left: 48px;
            margin-left: -10px;
        }

        .ol-popup:before {
            border-top-color: var(--popup-border-color);
            border-width: 11px;
            left: 48px;
            margin-left: -11px;
        }

        .ol-popup-closer {
            text-decoration: none;
            position: absolute;
            top: 2px;
            right: 8px;
        }

        .ol-popup-closer:after {
            content: "✖";
        }
    </style>
</head>

<body>
    <div id="map"></div>
        <div id="logotipo">
        <a href="https://maparutasmtb.blogspot.com/" target="_blank">
          <img src="https://raw.githubusercontent.com/nanoflojo/MaparutasMTB/master/LogoMRmtbBaja.jpg" style="position: absolute; bottom: 0.6em; left: 0.6em; z-index: 10; width: 80px; " />
        </a>
        </div>
    <div id="info">&nbsp;</div>
    <div id="popup" class="ol-popup">
        <a href="#" id="popup-closer" class="ol-popup-closer"></a>
        <div id="popup-content"></div>
    </div>
    <script>
        // Estilo del vector drag and drop
        var defaultStyle = {
            'Point': new ol.style.Style({
                image: new ol.style.Icon({ src: 'https://raw.githubusercontent.com/nanoflojo/MaparutasMTB/master//Red_flag_OK_24.png' })
            }),
            'MultiLineString': new ol.style.Style({
                stroke: new ol.style.Stroke({
                    color: '#FF8B01',
                    width: 3
                })
            }),
        };

        var styleFunction = function (feature, resolution) {
            var featureStyleFunction = feature.getStyleFunction();
            if (featureStyleFunction) {
                return featureStyleFunction.call(feature, resolution);
            } else {
                return defaultStyle[feature.getGeometry().getType()];
            }
        };


        // Importar las clases necesarias para Drag and Drop
        const VectorSource = ol.source.Vector;
        const VectorImageLayer = ol.layer.VectorImage;

        const dragAndDropInteraction = new ol.interaction.DragAndDrop({
            sourceProjections: ['EPSG:4326', 'EPSG:3857'],
            formatConstructors: [
                ol.format.GeoJSON,
                ol.format.GML3,
                ol.format.KML,
                ol.format.WFS,
                ol.format.WKT,
                ol.format.GPX,
                ol.format.OSMXML,
            ],
        });

        //Visualización PNOA wms
        const projection_PNOA = ol.proj.get('EPSG:4326');
        const projectionExtent_PNOA = projection_PNOA.getExtent();
        const size_PNOA = ol.extent.getWidth(projectionExtent_PNOA) / 512;

        const resolutions_PNOA = Array.from({ length: 18 }, (_, z) => size_PNOA / Math.pow(2, z));
        const matrixIds_PNOA = Array.from({ length: 18 }, (_, z) => `EPSG:4326:${z}`);

        // Creamos el estilo del cluster agrupación fuentes
        var styleCache = {};
        function getStyle(feature, resolution) {
            var size = feature.get('features').length;
            var style = styleCache[size];
            if (!style) {
                var color = size > 50 ? "0, 174, 255" : size > 25 ? "27, 189, 255" : size > 16 ? "0, 200, 255" : size > 8 ? "0, 210, 255" : size > 1 ? "0, 220, 255" : "0, 90, 255";
                var radius = Math.max(6, Math.min(size * 0.75, 40));

                style = styleCache[size] = new ol.style.Style({
                    image: new ol.style.Circle({
                        radius: radius,
                        stroke: new ol.style.Stroke({
                            color: "rgba(" + color + ",0.5)",
                            width: 5,

                        }),
                        fill: new ol.style.Fill({
                            color: "rgba(" + color + ",0.5)"
                        })
                    }),

                    text: new ol.style.Text({
                        text: size.toString(),
                        fill: new ol.style.Fill({
                            color: '#fff'
                        })
                    })
                });
            }
            return style;
        };

        // Configuramos un vector para leer los datos Geojson	
        var fuentes = new ol.source.Vector({
            url: "https://gist.githubusercontent.com/nanoflojo/c8f570b92b4997c55c8c2e80de6d1bb3/raw/da211f8f16a3d2fa21d6c6efa34a4bf6079d6c2e/FuentesTODO.json",
            format: new ol.format.GeoJSON(),
            style: (styleCache /*style_point*/)
        });
        // Se crea una capa Vector para visualizar los datos GeoJson.
        var vectorLayer = new ol.layer.Vector({
            source: fuentes,
        });

        // El Cluster source se configura con otro vector
        var clusterSource = new ol.source.Cluster({
            source: fuentes,
            distance: 80
        });

        // Creamos la capa Vector del Cluster con su estilo correspondiente
        var clusterLayer = new ol.layer.Vector({
            source: clusterSource,
            style: getStyle,
        });

        //constructor para el control de ubicación
        class PosicionActual extends ol.control.Control {
            constructor() {

                const boton = document.createElement('button');
                boton.innerHTML = 'L';

                const contenedor = document.createElement('div');
                contenedor.className = 'posicion-actual ol-control';
                contenedor.appendChild(boton);
                super({
                    element: contenedor,
                })

                boton.addEventListener('click', this.ubicar.bind(this));
            }
            ubicar() {
                geolocation.setTracking(true);
            }
        }

        // Creación del mapa, la vista, las capas, añadiendo el cluster Geojson de las fuentes y el control de ubicación
        var map = new ol.Map({
            layers: [
                new ol.layer.Group({
                    title: 'Otros mapas',
                    visible: true,
                    layers: [
                        new ol.layer.Tile({
                            title: 'Esri Topo',
                            opacity: 1.000000,
                            type: 'base',
                            visible: false,
                            source: new ol.source.XYZ({
                                attributions: '<a target="_blank" href="https://openlayers.org/">OpenLayers</a> Tiles © <a target="_blank" href="https://services.arcgisonline.com/ArcGIS/' +
                                    'rest/services/World_Topo_Map/MapServer">ArcGIS</a> Powered by <a target="_blank" href="https://www.esri.com/es-es/home/">ESRI</a>',
                                url: 'https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}'
                            })
                        }),
                        new ol.layer.Tile({
                            title: 'Esri Streets',
                            opacity: 1.000000,
                            type: 'base',
                            visible: false,
                            source: new ol.source.XYZ({
                                attributions: '<a target="_blank" href="https://openlayers.org/">OpenLayers</a> Tiles © <a target="_blank" href="https://www.esri.com/es-es/arcgis/products/arcgis-online/overview">ArcGIS</a> Powered by <a target="_blank" href="https://www.esri.com/es-es/home/">ESRI</a>',
                                url: 'https://server.arcgisonline.com/ArcGIS/rest/services/' +
                                    'World_Topo_Map/MapServer/tile/{z}/{y}/{x}'
                            })
                        }),
                        new ol.layer.Tile({
                            'title': 'OpenTopoMap',
                            'type': 'base',
                            'visible': 'false',
                            'opacity': 1.000000,
                            source: new ol.source.XYZ({
                                attributions: [
                                    '<a target="_blank" href="https://openlayers.org/">OpenLayers</a>  ©  <a target="_blank" href="https://opentopomap.org/#map=5/49.000/10.000">OpenTopoMap</a> CC-BY-SA',
                                    ol.source.OSM.ATTRIBUTION
                                ],
                                url: 'http://c.tile.opentopomap.org/{z}/{x}/{y}.png'
                            })
                        }),
                        new ol.layer.Tile({
                            title: 'Mapa transporte público',
                            type: 'base',
                            visible: false,
                            source: new ol.source.XYZ({
                                attributions: [
                                    'CC-BY-SA © <a target="_blank" href="https://memomaps.de/en/homepage/">MeMoMaps</a>',
                                    ol.source.OSM.ATTRIBUTION
                                ],
                                url: 'http://tileserver.memomaps.de/tilegen/{z}/{x}/{y}.png'
                            })
                        }),
                        new ol.layer.Group({
                            title: 'Callejero IGN',
                            type: 'base',
                            combine: true,
                            visible: false,
                            layers: [
                                new ol.layer.Tile({
                                    source: new ol.source.TileWMS(({
                                        preload: 4,
                                        url: "http://www.ign.es/wms-inspire/mapa-raster",
                                        attributions: '<a target="_blank" href="https://openlayers.org/">OpenLayers</a> Teselas cartográficas cedidas por © <a target="_blank" href="https://www.ign.es/web/ign/portal">Instituto Geográfico Nacional de España</a>',
                                        params: {
                                            "LAYERS": "Fondo",
                                            "TILED": "true",
                                            "VERSION": "1.3.0"
                                        },
                                    })),
                                    opacity: 1.000000,
                                }),
                                new ol.layer.Tile({
                                    source: new ol.source.TileWMS(({
                                        url: "http://www.ign.es/wms-inspire/ign-base",
                                        attributions: '<a target="_blank" href="https://openlayers.org/">OpenLayers</a> - CC BY 4.0 <a href="http://www.scne.es/">SCNE</a>',
                                        params: {
                                            "LAYERS": "IGNBaseTodo-nofondo",
                                            "TILED": "true",
                                            "VERSION": "1.0.0"
                                        },
                                    })),
                                    opacity: 1.000000,
                                }),
                            ]
                        }),
                        new ol.layer.Tile({
                            title: 'OpenCycleMap',
                            type: 'base',
                            visible: false,
                            source: new ol.source.XYZ({
                                attributions: [
                                    '<a target="_blank" href="https://openlayers.org/">OpenLayers</a> © <a target="_blank" href="https://www.opencyclemap.org/">OpenCycleMap</a>',
                                    ol.source.OSM.ATTRIBUTION
                                ],
                                url: 'https://{a-c}.tile.thunderforest.com/cycle/{z}/{x}/{y}.png' +
                                    '?apikey=081ff7d83c0549c7a758fdd4df478f0f'
                            })
                        }),
                        new ol.layer.Tile({
                            title: 'CyclOSM',
                            type: 'base',
                            visible: false,
                            source: new ol.source.XYZ({
                                attributions: [
                                    '<a target="_blank" href="https://openlayers.org/">OpenLayers</a> - <a target="_blank" href="https://www.cyclosm.org/">CyclOSM</a>',
                                    ol.source.OSM.ATTRIBUTION
                                ],
                                url: 'https://dev.{a-c}.tile.openstreetmap.fr/cyclosm/{z}/{x}/{y}.png'
                            })
                        }),
                        new ol.layer.Group({
                            title: 'Mapa Raster del IGN',
                            type: 'base',
                            combine: true,
                            visible: false,
                            layers: [
                                new ol.layer.Tile({
                                    source: new ol.source.TileWMS(({
                                        preload: 4,
                                        url: "http://www.ign.es/wms-inspire/mapa-raster",
                                        attributions: '<a target="_blank" href="https://openlayers.org/">OpenLayers</a> Teselas cartográficas cedidas por © <a target="_blank" href="https://www.ign.es/web/ign/portal">Instituto Geográfico Nacional de España</a>',
                                        params: {
                                            "LAYERS": "Fondo",
                                            "TILED": "true",
                                            "VERSION": "1.3.0"
                                        },
                                    })),
                                    opacity: 1.000000,
                                }),
                                new ol.layer.Tile({
                                    source: new ol.source.TileWMS(({
                                        preload: 4,
                                        url: "http://www.ign.es/wms-inspire/mapa-raster",
                                        attributions: '<a target="_blank" href="https://openlayers.org/">OpenLayers</a> Teselas cartográficas cedidas por © <a target="_blank" href="https://www.ign.es/web/ign/portal">Instituto Geográfico Nacional de España</a>',
                                        params: {
                                            "LAYERS": "mtn_rasterizado",
                                            "TILED": "true",
                                            "VERSION": "1.3.0"
                                        },
                                    })),
                                    opacity: 1.000000,
                                }),

                            ]
                        }),
                        new ol.layer.Tile({
                            title: "OpenStreetMap",
                            opacity: 1.000000,
                            type: 'base',
                            visible: false,
                            source: new ol.source.XYZ({
                                attributions: [
                                    '<a target="_blank" href="https://openlayers.org/">OpenLayers</a>',
                                    ol.source.OSM.ATTRIBUTION,
                                ],
                                url: "http://a.tile.openstreetmap.org/{z}/{x}/{y}.png",
                            }),
                        }),
                    ]
                }),
                new ol.layer.Group({
                    title: 'Mapa Base',
                    visible: true,
                    layers: [
                        new ol.layer.Tile({
                            source: new ol.source.WMTS(({
                                url: "http://www.ign.es/wmts/pnoa-ma",
                                attributions: '<a target="_blank" href="https://openlayers.org/">OpenLayers</a> Teselas de PNOA cedidas por © <a target="_blank" href="https://www.ign.es/web/ign/portal">Instituto Geográfico Nacional de España</a>',
                                "layer": "OI.OrthoimageCoverage",
                                "TILED": "true",
                                matrixSet: 'EPSG:4326',
                                format: 'image/jpeg',
                                projection: projection_PNOA,
                                tileGrid: new ol.tilegrid.WMTS({
                                    origin: ol.extent.getTopLeft(projectionExtent_PNOA),
                                    resolutions: resolutions_PNOA,
                                    matrixIds: matrixIds_PNOA
                                }),
                                style: 'default',
                                wrapX: true,
                                "VERSION": "1.0.0",
                            })),
                            title: "Satélite PNOA limpio",
                            type: 'base',
                            visible: true,
                            opacity: 1.0,
                        }),
                        new ol.layer.Group({
                            title: 'Satelite y callejero',
                            type: 'base',
                            combine: true,
                            visible: true,
                            layers: [
                                new ol.layer.Tile({
                                    source: new ol.source.WMTS(({
                                        url: "http://www.ign.es/wmts/pnoa-ma",
                                        attributions: '<a target="_blank" href="https://openlayers.org/">OpenLayers</a> Teselas de PNOA cedidas por © <a target="_blank" href="https://www.ign.es/web/ign/portal">Instituto Geográfico Nacional de España</a>',
                                        "layer": "OI.OrthoimageCoverage",
                                        matrixSet: 'EPSG:4326',
                                        format: 'image/jpeg',
                                        projection: projection_PNOA,
                                        tileGrid: new ol.tilegrid.WMTS({
                                            origin: ol.extent.getTopLeft(projectionExtent_PNOA),
                                            resolutions: resolutions_PNOA,
                                            matrixIds: matrixIds_PNOA
                                        }),
                                        style: 'default',
                                        wrapX: true,
                                        "VERSION": "1.0.0",
                                    })),
                                    opacity: 1.0,
                                }),
                                new ol.layer.Tile({
                                    source: new ol.source.TileWMS(({
                                        url: "http://www.ign.es/wms-inspire/ign-base",
                                        attributions: ' - CC BY 4.0 <a href="http://www.scne.es/">SCNE</a>',
                                        params: {
                                            "LAYERS": "IGNBaseOrto",
                                            "TILED": "true",
                                            "VERSION": "1.3.0"
                                        },
                                    })),
                                    opacity: 1.000000,
                                })
                            ]
                        })
                    ]
                }),
                clusterLayer
            ],
            target: 'map',
            view: new ol.View({
                center: ol.proj.fromLonLat([-3.8858333333333333, 39.7]),
                zoom: 6.8,
            })
        });

        // Agregar la interacción Drag an drop al mapa
        map.addInteraction(dragAndDropInteraction);

        // Construcción y funciones de Drag and drop
        dragAndDropInteraction.on('addfeatures', function (event) {
            const vectorSource = new VectorSource({
                features: event.features,
            });
            map.addLayer(
                new VectorImageLayer({
                    source: vectorSource,
                    style: styleFunction
                }),
            );
            map.getView().fit(vectorSource.getExtent());
        });

        // Consolidar la lógica de mostrar información de características en un único listener
        const displayFeatureInfo = (pixel) => {
            const features = [];
            map.forEachFeatureAtPixel(pixel, (feature) => {
                features.push(feature);
            });

            const info = features.map((feature) => feature.get('name')).filter(Boolean).join(', ');
            document.getElementById('info').innerHTML = info || '&nbsp;';
        };

        map.on('pointermove', (evt) => {
            if (evt.dragging) return;
            displayFeatureInfo(evt.pixel);
            const hit = map.hasFeatureAtPixel(evt.pixel);
            document.getElementById('map').style.cursor = hit ? 'pointer' : '';
        });

        map.on('click', (evt) => {
            const feature = map.forEachFeatureAtPixel(evt.pixel, (feature, layer) => {
                const features = feature.get('features');
                return features ? features[0] : feature;
            });

            if (feature) {
                const geometry = feature.getGeometry();
                const coord = geometry.getCoordinates();
                const content = feature.get("name");
                document.getElementById("popup-content").innerHTML = content;
                overlay.setPosition(coord);
                console.info(feature.getProperties());
            }
        });
        // Elemento para mostrar mensajes de error o feedback
        const feedbackElement = document.createElement('div');
        feedbackElement.id = 'geolocation-feedback';
        feedbackElement.style.position = 'absolute';
        feedbackElement.style.bottom = '10px';
        feedbackElement.style.left = '10px';
        feedbackElement.style.padding = '10px';
        feedbackElement.style.backgroundColor = 'rgba(255, 255, 255, 0.8)';
        feedbackElement.style.border = '1px solid #ccc';
        feedbackElement.style.borderRadius = '5px';
        feedbackElement.style.fontSize = '14px';
        feedbackElement.style.display = 'none';
        document.body.appendChild(feedbackElement);

        const showFeedback = (message, isError = false) => {
            feedbackElement.style.color = isError ? 'red' : 'green';
            feedbackElement.innerHTML = message;
            feedbackElement.style.display = 'block';
            setTimeout(() => {
                feedbackElement.style.display = 'none';
            }, 5000);
        };

        // carga el control de geolocalización
        map.addControl(new PosicionActual());

        // Estilo de la geolocalización
        const posicionFeature = new ol.Feature();
        posicionFeature.setStyle(
            new ol.style.Style({
                image: new ol.style.Circle({
                    radius: 5,
                    fill: new ol.style.Fill({
                        color: '#fff',
                    }),
                    stroke: new ol.style.Stroke({
                        color: '#ff0000',
                        width: 2
                    })
                })
            })
        );
        // Costrucción de la Geolocalización
        const exactitudFeature = new ol.Feature();

        const vectorLayerPosicion = new ol.layer.Vector({
            source: new ol.source.Vector({
                features: [posicionFeature, exactitudFeature]
            })
        });
        map.addLayer(vectorLayerPosicion);

        // Configuración de la geolocalización
        const geolocation = new ol.Geolocation({
            projection: map.getView().getProjection()
        });

        geolocation.on('change', function () {
            console.log(geolocation.getPosition());
            showFeedback('Geolocalización exitosa. Centrándose en su ubicación.');
            zoomFeature();
            geolocation.setTracking(false);
        });

        geolocation.on('error', function (evt) {
            console.error(evt.message);
            showFeedback(`Error en la geolocalización: ${evt.message}`, true);
        });

        geolocation.on('change:accuracyGeometry', function () {
            exactitudFeature.setGeometry(geolocation.getAccuracyGeometry());
        });

        geolocation.on('change:position', function () {
            const coordenadas = geolocation.getPosition();
            posicionFeature.setGeometry(new ol.geom.Point(coordenadas));
            map.getView().setCenter(coordenadas);
            map.setView(new ol.View({
                center: coordenadas,
                zoom: 13
            }));
        });

        // Configuración del popup
        var container = document.getElementById("popup"),
            content_element = document.getElementById("popup-content"),
            closer = document.getElementById("popup-closer");

        closer.onclick = function () {
            overlay.setPosition(undefined);
            closer.blur();
            return false;
        };
        var overlay = new ol.Overlay({
            element: container,
            autoPan: true,
            offset: [0, -10],
        });

        // construcción del Geocoder 
        map.addOverlay(overlay);
        var geocoder = new Geocoder('nominatim', {
            provider: 'osm',
            lang: 'en',
            placeholder: 'Search for ...',
            limit: 5,
            debug: false,
            autoComplete: true,
            keepOpen: true
        });

        map.addControl(geocoder);

        geocoder.on('addresschosen', function (evt) {
            console.info(evt);
            window.setTimeout(function () {
                popup.show(evt.coordinate, evt.address.formatted);
            }, 3000);
        });

        map.on("click", function (evt) {
            var feature = map.forEachFeatureAtPixel(
                evt.pixel,
                function (feature, layer) {
                    var features = feature.get('features');
                    if (features) {
                        return features[0];
                    }
                    return feature;
                }
            );
            if (feature) {
                var geometry = feature.getGeometry();
                var coord = geometry.getCoordinates();
                var content = feature.get("name");
                content_element.innerHTML = content;
                overlay.setPosition(coord);
                console.info(feature.getProperties());
            }
        });

        // Función para mostrar las coordenadas al mover el ratón
        map.on('pointermove', (e) => {
            const pixel = map.getEventPixel(e.originalEvent);
            const hit = map.hasFeatureAtPixel(pixel);
            document.getElementById('map').style.cursor = hit ? 'pointer' : '';
        });


        // Se añade los controles que faltan
        var fullscreen = new ol.control.FullScreen();
        map.addControl(fullscreen);

        var scaleLine = new ol.control.ScaleLine({ units: 'metric' });
        map.addControl(scaleLine);

        var zoomslider = new ol.control.ZoomSlider();
        map.addControl(zoomslider);

        var mouse_position = new ol.control.MousePosition({
            coordinateFormat: ol.coordinate.createStringXY(4),
            projection: 'EPSG:4326'
        });
        map.addControl(mouse_position);

        var layerSwitcher = new ol.control.LayerSwitcher({
        });
        map.addControl(layerSwitcher);
    </script>
</body>

</html>
